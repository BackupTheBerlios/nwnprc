<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>PRC Server Pack 1.7</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
</head>

<body>

<h1>PRC Server Pack Install</h1>

<p>The server pack contains many useful utilities for running a server with the PRC. It is available as a Windows installer or a rar archive for manual installation. This covers manually installing the server pack and what to do with the components. While it is designed for a server running on Windows, the server pack is still useful for Linux servers because it contains the precacher.</p>

<p>The current version of the server pack is 1.7.</p>

<!--more-->

<h3>Why Do a Manual Install?</h3>

<ul>
	<li>The Windows installer only works on a PC running Windows and that has NWN installed, so is no use for:
		<ul>
			<li>Other operating systems</li>
			<li>PCs without NWN installed</li>
			<li>The standalone server (it looks for registry entries the server doesn't create)</li>
		</ul>
	</li>
	<li>It includes utilities you either don't need or use already</li>
        <li>It makes its own registry entries</li>
</ul>

<h3>Installing the Server Pack - File List</h3>

<p>If you have a previous version of the server pack, uninstall that first. Download and unpack the rar file. It should contain the following:

<ul>
	<li>NWNX 2.6.1</li>
        <li>NWNX-ODBC 0.9.2.4</li>
        <li>NWNX-Letoscript build 23 beta 4</li>
        <li>NWNX-Profiler 1.60</li>
        <li>SQLite 3.3.6</li>
        <li>Precacher (prc.jar, erf.exe, batch files to run it)</li>
        <li>NWNX for Linux 2.5.3rc1 (source plus precompiled binary)</li>
        <li>NWNX-InvFixpl 1.0</li>
        <li>documentation</li>

</ul>

</p>

<h3>Installing the Server Pack - NWNx</h3>

<p>The server pack contains NWNx, various NWNx plugins and the NWNx documentation. Further information and the Linux binaries can be found on their site. To install NWNx, put the following files in your NWN directory:

<ul>
	<li>nwnx2.exe</li>
	<li>nwnx.ini</li>
	<li>madCHook.dll</li>
	<li>nwnx-module.dll</li>
</ul>

nwnx2.exe, nwnx.ini, madCHook.dll, nwnx-module.dll</p>

<p>That's it - installed. Look at nwnx.ini to configure it. The default .ini is usually fine, all you need to do is add the name of the module to load in the right place <strong>leaving out the .mod extension</strong> eg. <br />
<code>Module = "MyModule"</code></p>

<p>The most common NWNx plugins are included in the server pack. While they are optional, the NWNx based 2DA cache <em>requires</em> the ODBC (database) plugin to work. </p>

<h4>ODBC Plugin (nwnx_odbc.dll)</h4>

<p>This provides the database connectivity. The <a href="http://www.nwnx.org/index.php?id=doc_odbc2" title="nwnx odbc plugin docs">online documentation</a> for the plugin covers pretty much everything. There's a copy of it in the server pack (nwnx_odbc2.html). The PRC scripts include the APS functions in inc_2dacache.nss and the initialisation function is already in the PRC's module load event script. Therefore there's no need to import the APS erf.</p>

<h4>LetoScript Plugin (LetoScript.dll, nwnx_leto.dll)</h4>

<p>The server pack comes with LetoScript version 3+24, which uses the Unicorn syntax. For the LetoScript functions to work, the server needs to be using servervault characters - strangely enough Letoscript can't edit files on a remote computer. Also be aware that LetoScript works out the bic filename by using the first 16 characters of the PC's first name + last name.</p>

<h4>Profiler Plugin (nwnx_profiler.dll)</h4>

<p>The plugin profiles running scripts, logging how often a script has been called and how much time it took to complete. The <a href="http://www.nwnx.org/index.php?id=doc_profiler" title="nwnx profiler plugin docs">online documentation</a> explains how it can be used. There's also a copy of it in the server pack (nwnx_profiler.html). It's not required for any PRC functions, but it's very useful.</p>

<h4>Inventory Fix Plugin (nwnx_invfixpl.dll)</h4>

<p>Surprisingly enough, this plugin fixes inventory lag. However, it also alters the value of some items, so it may not be suitable for all persistent worlds. See the invfixpl_readme.txt in the server pack for more information.</p>

<h3>Installing the Server Pack - The Precacher</h3>

<h4>Why Bother?</h4>

<p>In a single player game, the PRC scripts read 2da data from the Bioware database (that's what the PRC_DATA.xxx files are for). For multiplayer, especially a persistent world, the Bioware one isn't really fast enough, so instead the PRC lets you store the 2da cache in the database used by NWNx. The precacher reads the PRC and some Bioware 2das into the database as doing this while playing causes the game to become unresponsive while it reads the 2das.</p>

<p>Note: using the NWNx database as the 2da cache is <em>required</em> for the Conversation Character Creator to work.</p>

<h4>Running the precacher on Windows</h4>

<p>First, install the PRC, then put the following files in the main NWN install directory:
<ul>
	<li>7za.exe</li>
        <li>erf.exe</li>
	<li>bioware2das.7z</li>
	<li>prc.jar (the precacher)</li>
	<li>Either precacher sqlite prc.bat or precacher mysql.bat, depending on which database you are using with NWNx</li>
        <li>sqlite.exe if using sqlite</li>
</ul>

<p>Double click on the appropriate batch file (precacher sqlite prc.bat for sqlite, precacher mysql.bat for mySQL).</p>

<h4>Running the precacher on Linux</h4>

<p>First, in the directory where you extracted prc.jar, create a directory called precacher2das. Add the following files to the precacher2das directory:

<ul>
        <li>extract Bioware 2da files from bioware2das.7z</li>
        <li>extract the 2da files from prc_2das.hak, prc_craft2das.hak and prc_race.hak, overwriting any duplicates</li>
</ul>

<p>Using the command line, go to the directory prc.jar is in and enter: <code>java -Xmx100m -jar prc.jar 2datosql precacher2das MySQL</code></p>

<p>Note: this method will also work for Windows if you don't want to use the batch file.</p>

<h3>Installing the Server Pack - Making the 2DA Cache Database</h3>

<h4>Using sqlite</h4>

<p>After the precacher has finished, a file called sqlite.db will have been created. This is the database and it just needs moving to the NWN install directory on the server.</p>

<h4>Using mySQL</h4>

<p>This assumes mySQL is in the PATH for Windows. The precacher creates a file called out.sql, which needs moving to the server where the mySQL database is going to be created.</p>

<ol>
        <li>open a command prompt</li>
        <li>go to the directory you put out.sql in</li>
        <li>type: <code>mysql -u user -p databasename < out.sql > out.log</code> (replace the user and databasename with whatever it should be)</li>
        <li>enter the password when prompted</li>
</ol>

<p>For Linux, the command line is:<br />
<code>cat out.sql| mysql -u user -p databasename</code></p>

<p>There are several arguements that mysql takes, eg -u username and â€“user=username are equivalent, see the <a href="http://dev.mysql.com/doc/refman/5.0/en/mysql-command-options.html" title="MySQL 5.0 Reference Manual :: 8.6.1 mysql Options">MySQL manual</a>.</p>

<p>The log file will be empty, but it stops mySQL echoing a confirmation after every line of the sql file (it has a lot of lines) and it stops if it encounters an error.</p>

<p>Note: the Linux version of NWNx only has mySQL support, also there is no Linux version of sqlite.</p>

<h3>That's It</h3>

<p>Suggestions please, particularly if something's missing or incorrect.</p>

<h3>Credits</h3>

<p>The ODBC and profiler plugins are from <a href="http://www.nwnx.org/index.php?id=nwnx2" title="plugin download page">nwnx.org</a>, the LetoScript plugin from <a href="http://sourceforge.net/projects/leto/">Project Leto's sourceforge site</a> and the inventory fix plugin from <a href="http://sourceforge.net/project/showfiles.php?group_id=174942&package_id=204100">nwnrcc's sourceforge site</a>. SQLite is avaliable from <a href="www.sqlite.org">www.sqlite.org</a>. The Precacher is based on a version made for the PRC by Yuritch, but rewritten into java by the PRC.</p>

</body>
</html>
